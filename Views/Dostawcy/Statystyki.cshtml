@model Projekt2.ViewModels.DostawcyStatystykiViewModel
@{
    ViewData["Title"] = "Statystyki";
    var labels1 = ViewBag.ChartLabels1 as string[];
    var values1 = ViewBag.ChartValues1 as int[];

    var labels2 = ViewBag.ChartLabels2 as string[];
    var values2 = ViewBag.ChartValues2 as double[];
}

<h1>Statystyki</h1>

<canvas id="chart1" width="800" height="400"></canvas>
<canvas id="chart2" width="800" height="400" style="margin-top: 50px;"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const chart1 = new Chart(document.getElementById('chart1').getContext('2d'), {
        type: 'bar',
        data: {
            labels: @Html.Raw(Json.Serialize(labels1)),
            datasets: [{
                label: 'Ilość towaru dostarczona',
                data: @Html.Raw(Json.Serialize(values1)),
                backgroundColor: 'rgba(75, 192, 192, 0.6)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: { y: { beginAtZero: true } }
        }
    });

        const chart2 = new Chart(document.getElementById('chart2').getContext('2d'), {
        type: 'line',
        data: {
            labels: @Html.Raw(Json.Serialize(labels2)),
            datasets: [{
                label: 'Wydajność (ton/ha)',
                data: @Html.Raw(Json.Serialize(values2)),
                backgroundColor: 'rgba(255, 159, 64, 0.6)',
                borderColor: 'rgba(255, 159, 64, 1)',
                fill: false,
                borderWidth: 2
            }]
        },
        options: {
            scales: { y: { beginAtZero: true } }
        }
    });

</script>
<!--
<div>
    Chart 2 Labels: string.Join(", ", labels2 ?? new string[0])
</div>
<div>
    Chart 2 Values: string.Join(", ", values2?.Select(v => v.ToString("0.00")) ?? new string[0])
</div>
-->


<div>

    <hr />
    <dl class="row">
        <dt class="col-sm-2">
			<h3>Najlepszy dostawca: </h3>
        </dt>
        @if (Model.BestDostawca != null)
        {
        <dd class="col-sm-10" onclick="location.href='@Url.Action("Details", "Dostawcy", new { id = Model.BestDostawca.Id })'" style="cursor:pointer;">
            @{
                var suma = Model.BestDostawca.Dostawy.Sum(d => (decimal?)d.Ilosc_towaru) ?? 0m;
                var ha = Model.BestDostawca.Ilosc_ha_pola;
                var wydajnosc = ha > 0 ? suma / ha : 0;
                <p><strong>Imię i nazwisko:</strong> @Model.BestDostawca.Name @Model.BestDostawca.Surname</p>
                <p><strong>Suma towaru:</strong> @suma kg</p>
                <p><strong>Powierzchnia pola:</strong> @ha ha</p>
                <p><strong>Wydajność:</strong> @wydajnosc.ToString("F2") kg/ha</p>
                }
            
        </dd>
        }
        else
        {
            <p>Brak danych o dostawcy.</p>
        }
        <hr />
        <dt class="col-sm-2">
            <h3>Najgorszy dostawca: </h3>
        </dt>
        @if (Model.WorstDostawca != null)
            {
        <dd class="col-sm-10" onclick="location.href='@Url.Action("Details", "Dostawcy", new { id = Model.WorstDostawca.Id })'" style="cursor:pointer;">
             @{
                var suma = Model.WorstDostawca.Dostawy.Sum(d => (decimal?)d.Ilosc_towaru) ?? 0m;
                var ha = Model.WorstDostawca.Ilosc_ha_pola;
                var wydajnosc = ha > 0 ? suma / ha : 0;
                <p><strong>Imię i nazwisko:</strong> @Model.WorstDostawca.Name @Model.WorstDostawca.Surname</p>
                <p><strong>Suma towaru:</strong> @suma kg</p>
                <p><strong>Powierzchnia pola:</strong> @ha ha</p>
                <p><strong>Wydajność:</strong> @wydajnosc.ToString("F2") kg/ha</p>
                }

        </dd>
        }
        else
        {
            <p>Brak danych o dostawcy.</p>
        }
        <hr />
        <dt class="col-sm-2">
            <h3>Najlepsze pole: </h3>
        </dt>
        <dd class="col-sm-10" onclick="location.href='@Url.Action("Details", "Dostawcy", new { id = Model.BestPole.Id })'" style="cursor:pointer;">
            @if (Model.BestPole != null)
            {
                var suma = Model.BestPole.Dostawy.Sum(d => (decimal?)d.Ilosc_towaru) ?? 0m;
                var ha = Model.BestPole.Ilosc_ha_pola;
                var wydajnosc = ha > 0 ? suma / ha : 0;

                <p><strong>Właściciel:</strong> @Model.BestPole.Name @Model.BestPole.Surname</p>
                <p><strong>Powierzchnia pola:</strong> @ha ha</p>
                <p><strong>Suma towaru:</strong> @suma kg</p>
                <p><strong>Wydajność:</strong> @wydajnosc.ToString("F2") kg/ha</p>
            }
            else
            {
                <p>Brak danych o dostawcy.</p>
            }
        </dd>
            
            

    </dl>
</div>

